{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/datepicker.min.css' %}">
<style>
    .input-long {
        height: 2rem;
        resize: none;
        margin-top: .5rem;
    }
</style>
{% endblock %}

{% block navigation %}
{% endblock %}

{% block content %}
<main class="signup">
    <div class="signup-wrapper">
        {% if messages %}
        {% for message in messages %}
        <div class="alert-wrapper {{ message.tags }}" role="alert">
            <i class="button-close fa-solid fa-xmark"></i>
            <div class="alert-text">
                {{ message }}
            </div>
        </div>
        {% endfor %}
        {% endif %}
        <h1 class="title-form">Create Your Account</h1>
        <form id="form_signup" method="POST">
            {% csrf_token %}
            <div class="me-5">
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-user"></i>
                    <div class="input-double">
                        <div class="input-field">
                            {{ signup_form.first_name }}
                            <label for="{{ signup_form.first_name.auto_id }}">
                                {{ signup_form.first_name.label }}
                                <span class="text-danger">*</span>
                            </label>
                            <span class="error"></span>
                        </div>
                        <div class="input-field">
                            {{ signup_form.last_name }}
                            <label for="{{ signup_form.last_name.auto_id }}">
                                {{ signup_form.last_name.label }}
                            </label>
                        </div>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-calendar-day"></i>
                    <div class="input-double">
                        <div class="input-field">
                            {{ signup_form.birth_place }}
                            <label for="{{ signup_form.birth_place.auto_id }}">
                                {{ signup_form.birth_place.label }}
                                <span class="text-danger">*</span>
                            </label>
                            <span class="error"></span>
                        </div>
                        <div class="input-field">
                            {{ signup_form.birth_date }}
                            <label for="{{ signup_form.birth_date.auto_id }}">
                                {{ signup_form.birth_date.label }}
                                <span class="text-danger">*</span>
                            </label>
                            <span class="error"></span>
                        </div>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-id-card"></i>
                    <div class="input-field">
                        {{ signup_form.id_number }}
                        <label for="{{ signup_form.id_number.auto_id }}">
                            {{ signup_form.id_number.label }}
                            <span class="text-danger">*</span>
                        </label>
                        <span class="error"></span>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-network-wired"></i>
                    <div class="input-field">
                        {{ signup_form.position }}
                        <label for="{{ signup_form.position.auto_id }}">
                            {{ signup_form.position.label }}
                            <span class="text-danger">*</span>
                        </label>
                        <span class="error"></span>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-map-location-dot"></i>
                    <div class="input-field">
                        {{ signup_form.address }}
                        <label for="{{ signup_form.address.auto_id }}">
                            {{ signup_form.address.label }}
                        </label>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-hands-praying"></i>
                    <div class="input-field">
                        {{ signup_form.religion }}
                        <label for="{{ signup_form.religion.auto_id }}">
                            {{ signup_form.religion.label }}
                        </label>
                    </div>
                </div>
            </div>
            <div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-venus-mars"></i>
                    <div class="input-field">
                        {{ signup_form.gender }}
                        <label for="{{ signup_form.gender.auto_id }}" class="active">
                            {{ signup_form.gender.label }}
                            <span class="text-danger">*</span>
                        </label>
                        <span class="error"></span>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-envelope"></i>
                    <div class="input-field">
                        {{ signup_form.email }}
                        <label for="{{ signup_form.email.auto_id }}">
                            {{ signup_form.email.label }}
                            <span class="text-danger">*</span>
                        </label>
                        <span class="error"></span>
                    </div>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-lock"></i>
                    <div class="input-field">
                        {{ signup_form.password }}
                        <label for="{{ signup_form.password.auto_id }}">
                            {{ signup_form.password.label }}
                            <span class="text-danger">*</span>
                        </label>
                        <span class="error"></span>
                        <span class="notice-input">
                            <ul>
                                <li>must use at least one capital letter</li>
                                <li>must use at least one special character</li>
                                <li>must be longer than 8</li>
                            </ul>
                        </span>
                    </div>
                    <i class="password-eye fa-solid fa-eye-slash"></i>
                </div>
                <div class="input-wrapper">
                    <i class="icon-input fa-solid fa-unlock"></i>
                    <div class="input-field">
                        {{ signup_form.retype_password }}
                        <label for="{{ signup_form.retype_password.auto_id }}">
                            {{ signup_form.retype_password.label }}
                            <span class="text-danger">*</span>
                        </label>
                        <span class="error"></span>
                        <span class="notice-input">
                            must be the same as the password
                        </span>
                    </div>
                    <i class="password-eye fa-solid fa-eye-slash"></i>
                </div>
            </div>
        </form>
        <button id="submit_signup" class="btn-submit btn btn-warning w-100" type="button">SIGNUP</button>
        <div class="link-login d-flex justify-content-between">
            <a class="text-warning" href="{% url 'userapp:login' %}">Alredy have an Account?</a>
        </div>
    </div>
    </div>
</main>
{% endblock %}

{% block javascript %}
<script src="{% static 'js/datepicker.min.js' %}"></script>
<script src="{% static 'js/jquery-3.5.1.js' %}"></script>
<script>
    // Text Area 
    $("#id_address").on("input", function () {
        if (this.value.length > 20) {
            $(this).css("height", "auto");
            $(this).css("height", this.scrollHeight);
        } else {
            $(this).css("height", "2rem");
        }
    })
    // Datepicker
    const inputDatepicker = [...document.querySelectorAll("input.datepicker-here")]
    inputDatepicker.forEach((elem) => {
        let max = elem.getAttribute('max')
        let min = elem.getAttribute('min')
        const datepicker = new Datepicker(elem, {
            format: 'dd MM yyyy',
            autohide: true,
            maxDate: max,
            minDate: min,
        })
    })
    // Signup
    const btnSignup = document.getElementById("submit_signup");
    btnSignup.addEventListener("click", (e) => {
        e.preventDefault();
        let input = checkInput(),
            retype_password = checkPassSame();
        if (!input.includes(false) && retype_password) {
            document.getElementById("form_signup").submit();
        }
    })
</script>
<script aria-label="input-js">
    const inputField = document.querySelectorAll("input:not(input[type='hidden']), .input-long");
    const labelInput = document.querySelectorAll("input:not(input[type='hidden'])~label, .input-long~label");
    for (let inp = 0; inp < inputField.length; inp++) {
        inputField[inp].addEventListener("focus", () => {
            if (!labelInput[inp].classList.contains("active")) {
                labelInput[inp].classList.add("active")
            }
        })
        if (inputField[inp].value !== "" || inputField[inp].type === "date") {
            labelInput[inp].classList.add("active")
        }
        inputField[inp].addEventListener("blur", (e) => {
            if (e.target.value === "" && e.target.type !== "date") {
                labelInput[inp].classList.remove("active")
            }
        })
    }
    const passwordEye = document.querySelectorAll(".input-wrapper i.password-eye");
    const passwordInput = document.querySelectorAll(".input-field input[type='password']")
    if (passwordEye !== null && passwordInput !== null) {
        for (let pass = 0; pass < passwordEye.length; pass++) {
            passwordEye[pass].addEventListener("click", (e) => {
                if (e.target.classList.contains("fa-eye-slash") && passwordInput[pass].type === "password") {
                    e.target.classList.remove("fa-eye-slash")
                    e.target.classList.add("fa-eye");
                    passwordInput[pass].type = "text";
                } else {
                    e.target.classList.remove("fa-eye");
                    e.target.classList.add("fa-eye-slash")
                    passwordInput[pass].type = "password";
                }
            })
        }
    }

    function checkInput() {
        let status = [],
            regEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,
            regPassword = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/gm,
            inputs = document.querySelectorAll("input[required], select[required]"),
            warnings = document.querySelectorAll("input[required]~.error, select[required]~.error"),
            len = Math.min(inputs.length, warnings.length);
        for (let inp = 0; inp < len; inp++) {
            let inpValue = inputs[inp].value
            if (inpValue === "")
                writeWarning(warnings[inp], "block", "don't be empty")
            else if (inputs[inp].type === "email" && !inpValue.match(regEmail))
                writeWarning(warnings[inp], "block", "please enter a valid email address")
            else if (inputs[inp].id === "id_password" && !inpValue.match(regPassword))
                writeWarning(warnings[inp], "block", "password is not strong")
            else
                writeWarning(warnings[inp], "none", "")
        }

        function writeWarning(warningElem, warningDisplay, warningText) {
            let statusRes = warningDisplay === "block" ? false : true;
            warningElem.textContent = warningText;
            warningElem.style.display = warningDisplay;
            status.push(statusRes)
        }
        return status
    }

    function checkPassSame() {
        let pass = document.getElementById("id_password"),
            rety = document.getElementById("id_retype_password"),
            warRety = rety.nextElementSibling.nextElementSibling;
        if (pass.value === "" || rety.value === "") return false
        if (pass.value !== rety.value) {
            warRety.textContent = "retype password is not same"
            warRety.style.display = "block";
            return false
        }
        return true
    }
</script>
{% endblock %}